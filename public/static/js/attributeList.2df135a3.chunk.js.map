{"version":3,"sources":["components/AttributeList.js"],"names":["Container","styled","div","_templateObject","List","_templateObject2","AttributeItem","_templateObject3","props","isDisabled","AttributeList","_this","Object","E_Projects_eav_packages_eav_dashboard_resources_js_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_classCallCheck__WEBPACK_IMPORTED_MODULE_9__","this","E_Projects_eav_packages_eav_dashboard_resources_js_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_possibleConstructorReturn__WEBPACK_IMPORTED_MODULE_11__","E_Projects_eav_packages_eav_dashboard_resources_js_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_getPrototypeOf__WEBPACK_IMPORTED_MODULE_12__","call","state","hasNextPage","isNextPageLoading","attributes","fromJS","selected","loading","search","getAttributes","reload","requestData","updateAttributes","item","removed","arguments","length","undefined","filter","x","get","push","setState","_ref","E_Projects_eav_packages_eav_dashboard_resources_js_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_asyncToGenerator__WEBPACK_IMPORTED_MODULE_8__","E_Projects_eav_packages_eav_dashboard_resources_js_node_modules_babel_preset_react_app_node_modules_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_6___default","a","mark","_callee","page","_ref2","data","meta","_meta$paginated","current_page","last_page","wrap","_context","prev","next","E_Projects_eav_packages_eav_dashboard_resources_js_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_objectSpread__WEBPACK_IMPORTED_MODULE_7__","fetchAttributes","entity","page[size]","page[number]","filter[unassigned]","filter[set]","set","id","filter[search]","sent","paginated","concat","stop","_x","apply","onSearch","input","target","value","isItemLoaded","index","size","loadNextPage","debounce","_this2","Item","_ref3","content","style","includes","react__WEBPACK_IMPORTED_MODULE_15___default","createElement","react_beautiful_dnd__WEBPACK_IMPORTED_MODULE_17__","key","draggableId","isDragDisabled","provided","snapshot","assign","ref","innerRef","draggableProps","dragHandleProps","antd_es_skeleton__WEBPACK_IMPORTED_MODULE_5__","active","paragraph","loadMoreItems","itemCount","suffix","antd_es_icon__WEBPACK_IMPORTED_MODULE_3__","type","antd_es_input__WEBPACK_IMPORTED_MODULE_1__","placeholder","onChange","droppableId","react_virtualized_auto_sizer__WEBPACK_IMPORTED_MODULE_20__","_ref4","height","width","react_window_infinite_loader__WEBPACK_IMPORTED_MODULE_19__","_ref5","onItemsRendered","react_window__WEBPACK_IMPORTED_MODULE_18__","itemSize","willChange","PureComponent"],"mappings":"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","file":"static/js/attributeList.2df135a3.chunk.js","sourcesContent":["import React, { PureComponent } from 'react';\r\nimport { Input, Skeleton, Icon } from 'antd';\r\nimport styled from 'styled-components';\r\nimport { Droppable, Draggable } from 'react-beautiful-dnd';\r\nimport { FixedSizeList } from \"react-window\";\r\nimport InfiniteLoader from \"react-window-infinite-loader\";\r\nimport AutoSizer from \"react-virtualized-auto-sizer\";\r\nimport { fromJS } from 'immutable';\r\nimport debounce from 'lodash.debounce';\r\n\r\nimport { fetchAttributes } from '../utils/WebAPI';\r\n\r\nconst Container = styled.div`\r\n    margin-left: 20px;\r\n    margin-bottom: 10px;\r\n`;\r\n\r\nconst List = styled.div`\r\n    overflow: auto;\r\n    height: calc(90vh - 108px);\r\n    padding: 8px;\r\n    border-radius: 6px;\r\n    border: 1px solid #e8e8e8;\r\n`;\r\n\r\nconst AttributeItem = styled.div`\r\n    border-radius: 6px;\r\n    margin-bottom: 8px;\r\n    padding: 10px;\r\n    background-color: ${props  => props.isDisabled ? '#e8e8e8' : '#fff' };\r\n    border: 1px solid #e8e8e8;\r\n`;\r\n\r\nclass AttributeList extends PureComponent {\r\n\r\n    state = {\r\n        hasNextPage: true,\r\n        isNextPageLoading: false,\r\n        attributes: fromJS([]),\r\n        selected: [],\r\n        loading: false,\r\n        search: '',\r\n    }\r\n\r\n    constructor(props) {\r\n        super(props);\r\n\r\n        this.props.getAttributes(this.getAttributes);\r\n        this.props.updateAttributes(this.updateAttributes);\r\n        this.props.reload(this.reload);\r\n        this.requestData = debounce(this.requestData, 800);\r\n    }\r\n\r\n    getAttributes = () => {\r\n        return this.state.attributes;\r\n    }\r\n\r\n    reload = () => {\r\n        this.requestData(1);\r\n    }\r\n\r\n    updateAttributes = (item, removed=false) => {\r\n\r\n        let selected = this.state.selected;\r\n\r\n        if (removed) {            \r\n            selected = selected.filter(x => x !== item.get('id'));\r\n        } else {\r\n            selected.push(item.get('id'))\r\n        }\r\n\r\n        this.setState({\r\n            selected,\r\n        });\r\n    }\r\n\r\n    requestData = async (page) => {\r\n        let attributes = page === 1? { attributes: fromJS([]) } : {};\r\n        this.setState({ isNextPageLoading: true, loading: true, ...attributes });\r\n\r\n        const { data, meta } = await fetchAttributes(\r\n            { entity: this.props.entity }, \r\n            { 'page[size]': 25, 'page[number]': page, 'filter[unassigned]': 1, 'filter[set]': this.props.set.id, 'filter[search]': this.state.search }\r\n        );\r\n\r\n        const { current_page , last_page } = meta.paginated;\r\n        let hasNextPage = false;\r\n        if(current_page < last_page) {\r\n            hasNextPage = true;\r\n        }\r\n        this.setState({ attributes: this.state.attributes.concat(fromJS(data)), isNextPageLoading: false, loading: false, hasNextPage, current_page });\r\n    }\r\n\r\n    onSearch = (input) => {\r\n        this.setState({ search: input.target.value });\r\n        this.requestData(1);\r\n    }\r\n\r\n    isItemLoaded = index => !this.state.hasNextPage || index < this.state.attributes.size;\r\n\r\n    loadNextPage = (...args) => {\r\n       return this.requestData((args[0]/25)+1);\r\n    }\r\n\r\n    render() {\r\n        const Item = ({ index, style }) => {\r\n            let content;\r\n            if (!this.isItemLoaded(index)) {\r\n                content = <Skeleton active paragraph={false}/>;\r\n            } else {\r\n                const item = this.state.attributes.get(index);\r\n                const isDisabled = this.state.selected.includes(item.get('id'));\r\n                content =  (<Draggable key={item.get('id')} draggableId={item.get('id')} index={index} isDragDisabled={isDisabled}>\r\n                    {(provided, snapshot) => (\r\n                        <AttributeItem\r\n                            ref={provided.innerRef}\r\n                            {...provided.draggableProps}\r\n                            {...provided.dragHandleProps}\r\n                            isDisabled={isDisabled}\r\n                        >\r\n                            {`${item.get('frontend_label')} (${item.get('attribute_code')})`}\r\n                        </AttributeItem>\r\n                    )}\r\n                </Draggable>);\r\n            }\r\n            return <div style={style}>{content}</div>;\r\n        }\r\n\r\n        const loadMoreItems = this.state.isNextPageLoading ? () => {} : this.loadNextPage;\r\n        const itemCount = this.state.hasNextPage ? this.state.attributes.size + 1 : this.state.attributes.size;\r\n        const suffix = this.state.loading ? <Icon type=\"loading\" /> : null;\r\n\r\n        return (\r\n            <div>\r\n                <Container>\r\n                    <Input\r\n                        placeholder=\"input search text\"\r\n                        onChange={this.onSearch}\r\n                        suffix={suffix}\r\n                    />\r\n                </Container>\r\n                <Container>\r\n                    <Droppable droppableId=\"attributes\" type=\"attributes\">\r\n                        {(provided, snapshot) => (\r\n                            <List\r\n                                ref={provided.innerRef}\r\n                            >\r\n                                <AutoSizer>\r\n                                    {({ height, width }) => (\r\n                                        <InfiniteLoader\r\n                                            isItemLoaded={this.isItemLoaded}\r\n                                            itemCount={itemCount}\r\n                                            loadMoreItems={loadMoreItems}\r\n                                        >\r\n                                            {({ onItemsRendered, ref }) => (                                                \r\n                                                <FixedSizeList\r\n                                                    itemCount={itemCount}\r\n                                                    onItemsRendered={onItemsRendered}\r\n                                                    height={height}\r\n                                                    width={width}\r\n                                                    itemSize={50}\r\n                                                    ref={ref}\r\n                                                    style={{\r\n                                                        willChange: \"unset\"\r\n                                                    }}\r\n                                                >\r\n                                                    {Item}\r\n                                                </FixedSizeList>                                                    \r\n                                            )}\r\n                                        </InfiniteLoader>\r\n                                    )}\r\n                                </AutoSizer>\r\n                                {provided.placeholder}\r\n                            </List>\r\n                        )}\r\n                    </Droppable>\r\n                </Container>\r\n            </div>\r\n        );\r\n    }\r\n}\r\n\r\nexport default AttributeList;\r\n"],"sourceRoot":""}